<div class="page-wrapper">
  <div class="page-container">
    <!-- Page Header -->
    <div class="page-header">
      <h1>System Settings</h1>
      <p class="page-subtitle">Configure integrations and system preferences</p>
    </div>

    <!-- Settings Tabs -->
    <mat-card class="settings-card">
      <mat-tab-group>
        <!-- SharePoint Configuration Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="tab-icon">folder</mat-icon>
            SharePoint
          </ng-template>
          <div class="tab-content">
            <div class="config-section">
              <h3>SharePoint Configuration</h3>
              <p class="config-description">Configure SharePoint integration for evidence file storage</p>
              
              <!-- SharePoint Form -->
              <div class="config-form-card">
                <div class="loading-overlay" *ngIf="loading">
                  <mat-spinner diameter="40"></mat-spinner>
                </div>
                <form class="config-form">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Tenant ID</mat-label>
                    <input matInput [(ngModel)]="sharepointConfig.tenantId" name="tenantId" placeholder="Your Microsoft 365 tenant ID">
                    <mat-hint>Azure Portal → Azure Active Directory → Properties → Tenant ID</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Site ID</mat-label>
                    <input matInput [(ngModel)]="sharepointConfig.siteId" name="siteId" placeholder="SharePoint site ID">
                    <mat-hint>SharePoint site ID where documents will be stored</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Drive ID</mat-label>
                    <input matInput [(ngModel)]="sharepointConfig.driveId" name="driveId" placeholder="Document library drive ID">
                    <mat-hint>Document library drive ID</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Base Folder Name</mat-label>
                    <input matInput [(ngModel)]="sharepointConfig.baseFolderName" name="baseFolderName" placeholder="Compliance-Documents">
                    <mat-hint>Root folder for compliance documents</mat-hint>
                  </mat-form-field>

                  <div class="button-row">
                    <button mat-raised-button color="primary" type="button" (click)="saveSharePointConfig()" [disabled]="sharepointSaving">
                      <mat-spinner diameter="18" *ngIf="sharepointSaving"></mat-spinner>
                      <mat-icon *ngIf="!sharepointSaving">save</mat-icon>
                      Save Configuration
                    </button>
                    <button mat-stroked-button type="button" (click)="testSharePointConnection()" [disabled]="sharepointTesting">
                      <mat-spinner diameter="18" *ngIf="sharepointTesting"></mat-spinner>
                      <mat-icon *ngIf="!sharepointTesting">check_circle</mat-icon>
                      Test Connection
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- Teams Configuration Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="tab-icon">group</mat-icon>
            Microsoft Teams
          </ng-template>
          <div class="tab-content">
            <div class="config-section">
              <h3>Microsoft Teams Integration</h3>
              <p class="config-description">Configure Teams webhook for automated compliance reports</p>
              
              <!-- Teams Form -->
              <div class="config-form-card">
                <div class="loading-overlay" *ngIf="loading">
                  <mat-spinner diameter="40"></mat-spinner>
                </div>
                <form class="config-form">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Webhook URL</mat-label>
                    <input matInput [(ngModel)]="teamsConfig.webhookUrl" name="webhookUrl" placeholder="https://outlook.office.com/webhook/...">
                    <mat-hint>Teams channel incoming webhook URL</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Channel Name</mat-label>
                    <input matInput [(ngModel)]="teamsConfig.channelName" name="channelName" placeholder="Compliance Updates">
                    <mat-hint>Name of the Teams channel for notifications</mat-hint>
                  </mat-form-field>

                  <div class="checkbox-group">
                    <h4>Notification Settings</h4>
                    <mat-checkbox [(ngModel)]="teamsConfig.sendDailySummary" name="sendDailySummary">Send daily compliance summary</mat-checkbox>
                    <mat-checkbox [(ngModel)]="teamsConfig.alertOverdue" name="alertOverdue">Alert on overdue tasks</mat-checkbox>
                    <mat-checkbox [(ngModel)]="teamsConfig.notifyCompletion" name="notifyCompletion">Notify on task completion</mat-checkbox>
                    <mat-checkbox [(ngModel)]="teamsConfig.weeklyReports" name="weeklyReports">Weekly compliance reports</mat-checkbox>
                  </div>

                  <div class="button-row">
                    <button mat-raised-button color="primary" type="button" (click)="saveTeamsConfig()" [disabled]="teamsSaving">
                      <mat-spinner diameter="18" *ngIf="teamsSaving"></mat-spinner>
                      <mat-icon *ngIf="!teamsSaving">save</mat-icon>
                      Save Configuration
                    </button>
                    <button mat-stroked-button type="button" (click)="testTeamsWebhook()" [disabled]="teamsTesting">
                      <mat-spinner diameter="18" *ngIf="teamsTesting"></mat-spinner>
                      <mat-icon *ngIf="!teamsTesting">send</mat-icon>
                      Send Test Message
                    </button>
                    <button mat-stroked-button color="accent" type="button" (click)="sendTestReport()" [disabled]="teamsSendingTestReport || !teamsConfig.webhookUrl">
                      <mat-spinner diameter="18" *ngIf="teamsSendingTestReport"></mat-spinner>
                      <mat-icon *ngIf="!teamsSendingTestReport">preview</mat-icon>
                      {{ teamsSendingTestReport ? 'Sending...' : 'Send Test Report' }}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- System Configuration Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="tab-icon">tune</mat-icon>
            System
          </ng-template>
          <div class="tab-content">
            <div class="config-section">
              <h3>System Configuration</h3>
              <p class="config-description">General system settings and preferences</p>
              
              <div class="config-items">
                <div class="config-item">
                  <mat-icon>storage</mat-icon>
                  <div>
                    <h4>Master Data</h4>
                    <p>Manage entities, departments, laws, and compliance categories</p>
                    <button mat-raised-button color="primary" routerLink="/admin/master-data">
                      Manage Master Data
                    </button>
                  </div>
                </div>

                <div class="config-item">
                  <mat-icon>people</mat-icon>
                  <div>
                    <h4>Users & Roles</h4>
                    <p>Manage user accounts and role assignments</p>
                    <button mat-raised-button color="primary" routerLink="/admin/users">
                      Manage Users
                    </button>
                  </div>
                </div>

                <div class="config-item">
                  <mat-icon>upload_file</mat-icon>
                  <div>
                    <h4>CSV Import</h4>
                    <p>Bulk import compliance tasks from CSV files</p>
                    <button mat-raised-button color="primary" routerLink="/admin/import">
                      Import Tasks
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- System Health Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="tab-icon">health_and_safety</mat-icon>
            System Health
          </ng-template>
          <div class="tab-content">
            <div class="config-section">
              <div class="health-header">
                <div>
                  <h3>System Health Monitor</h3>
                  <p class="config-description">Real-time system diagnostics and performance metrics</p>
                </div>
                <button mat-raised-button (click)="refreshSystemHealth()" [disabled]="healthLoading">
                  <mat-icon>refresh</mat-icon>
                  Refresh
                </button>
              </div>

              <div *ngIf="healthLoading" class="health-loading">
                <mat-spinner diameter="50"></mat-spinner>
                <p>Loading system health data...</p>
              </div>

              <div *ngIf="!healthLoading && systemHealth" class="health-grid">
                <!-- Database Health -->
                <mat-card class="health-card">
                  <div class="health-card-header">
                    <mat-icon [class.health-ok]="systemHealth.database.status === 'OK'" 
                              [class.health-error]="systemHealth.database.status !== 'OK'">
                      storage
                    </mat-icon>
                    <h4>Database</h4>
                  </div>
                  <div class="health-status" [class.status-ok]="systemHealth.database.status === 'OK'"
                       [class.status-error]="systemHealth.database.status !== 'OK'">
                    {{ systemHealth.database.status }}
                  </div>
                  <p class="health-message">{{ systemHealth.database.message }}</p>
                  <div class="health-metrics">
                    <div class="metric">
                      <span class="metric-label">Response Time</span>
                      <span class="metric-value">{{ systemHealth.database.responseTime }}ms</span>
                    </div>
                  </div>
                </mat-card>

                <!-- SharePoint Integration -->
                <mat-card class="health-card">
                  <div class="health-card-header">
                    <mat-icon [class.health-ok]="systemHealth.sharepoint.status === 'OK'" 
                              [class.health-error]="systemHealth.sharepoint.status !== 'OK'">
                      folder
                    </mat-icon>
                    <h4>SharePoint</h4>
                  </div>
                  <div class="health-status" [class.status-ok]="systemHealth.sharepoint.status === 'OK'"
                       [class.status-error]="systemHealth.sharepoint.status !== 'OK'">
                    {{ systemHealth.sharepoint.status }}
                  </div>
                  <p class="health-message">{{ systemHealth.sharepoint.message }}</p>
                  <div class="health-metrics" *ngIf="systemHealth.sharepoint.configured">
                    <div class="metric">
                      <span class="metric-label">Configured</span>
                      <span class="metric-value">
                        <mat-icon class="metric-icon">check_circle</mat-icon>
                      </span>
                    </div>
                  </div>
                </mat-card>

                <!-- Teams Integration -->
                <mat-card class="health-card">
                  <div class="health-card-header">
                    <mat-icon [class.health-ok]="systemHealth.teams.status === 'OK'" 
                              [class.health-error]="systemHealth.teams.status !== 'OK'">
                      group
                    </mat-icon>
                    <h4>Microsoft Teams</h4>
                  </div>
                  <div class="health-status" [class.status-ok]="systemHealth.teams.status === 'OK'"
                       [class.status-error]="systemHealth.teams.status !== 'OK'">
                    {{ systemHealth.teams.status }}
                  </div>
                  <p class="health-message">{{ systemHealth.teams.message }}</p>
                  <div class="health-metrics" *ngIf="systemHealth.teams.configured">
                    <div class="metric">
                      <span class="metric-label">Configured</span>
                      <span class="metric-value">
                        <mat-icon class="metric-icon">check_circle</mat-icon>
                      </span>
                    </div>
                  </div>
                </mat-card>

              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card>
  </div>
</div>
