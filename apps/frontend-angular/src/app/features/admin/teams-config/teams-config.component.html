<div class="page-wrapper">
  <div class="page-container">
    <!-- Page Header -->
    <div class="page-header">
      <h1>Teams Configuration</h1>
      <p class="page-subtitle">Configure Microsoft Teams integration for compliance notifications</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading configuration...</p>
    </div>

    <!-- Config Card -->
    <mat-card class="content-card" *ngIf="!loading">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>groups</mat-icon>
          Webhook Configuration
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="configForm">
          <p class="info-text">
            Configure Microsoft Teams webhook to receive automated compliance notifications and weekly reports
          </p>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Teams Webhook URL</mat-label>
            <input
              matInput
              formControlName="webhookUrl"
              placeholder="https://outlook.office.com/webhook/..."
            >
            <mat-icon matPrefix>link</mat-icon>
            <mat-error *ngIf="configForm.get('webhookUrl')?.hasError('required')">
              Webhook URL is required
            </mat-error>
            <mat-error *ngIf="configForm.get('webhookUrl')?.hasError('pattern')">
              Please enter a valid Teams webhook URL
            </mat-error>
          </mat-form-field>

          <div class="button-group">
            <button
              mat-raised-button
              color="primary"
              (click)="saveConfig()"
              [disabled]="saving || configForm.invalid"
            >
              <mat-icon>save</mat-icon>
              <span *ngIf="!saving">Save Configuration</span>
              <span *ngIf="saving">Saving...</span>
            </button>

            <button
              mat-button
              (click)="testConnection()"
              [disabled]="testing || configForm.invalid"
            >
              <mat-icon>check_circle</mat-icon>
              <span *ngIf="!testing">Test Connection</span>
              <span *ngIf="testing">Testing...</span>
            </button>

            <button
              mat-button
              (click)="triggerWeeklyReport()"
              [disabled]="configForm.invalid"
            >
              <mat-icon>send</mat-icon>
              Trigger Weekly Report
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Help Card -->
    <mat-card class="help-card" *ngIf="!loading">
      <mat-card-content>
        <div class="help-content">
          <mat-icon>help_outline</mat-icon>
          <div>
            <h3>How to Get Teams Webhook URL</h3>
            <ol>
              <li>Open Microsoft Teams and go to your desired channel</li>
              <li>Click on the three dots (•••) next to the channel name</li>
              <li>Select "Connectors" or "Workflows"</li>
              <li>Search for "Incoming Webhook" and click "Add"</li>
              <li>Give it a name (e.g., "Compliance Notifications")</li>
              <li>Copy the webhook URL and paste it above</li>
            </ol>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
